<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Paneli ‚Äì DFIB</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(135deg, #059669, #10b981); font-family: 'Inter', sans-serif; }
    .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(16, 185, 129, 0.3); }
    .status-pending { background-color: #fef3c7; color: #b45309; }
    .status-approved { background-color: #d1fae5; color: #065f46; }
    .status-rejected { background-color: #fee2e2; color: #991b1b; }
  </style>
</head>
<body class="min-h-screen p-6">

  <script>
    const current_user = localStorage.getItem("current_user");
    if (!localStorage.getItem("authenticated") || current_user !== "admin") {
      alert("Siz admin emassiz! Sizga ruxsat yo'q.");
      window.location.href = "login.html";
    }
  </script>

  <div class="card max-w-4xl mx-auto p-8 rounded-2xl shadow-xl">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold text-emerald-700">üîê Admin Paneli</h1>
      <a href="index.html" class="bg-emerald-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-emerald-600 transition">Asosiy sahifaga</a>
    </div>

    <p class="text-gray-600 mb-6">Yangi foydalanuvchilarning kirish so‚Äòrovlari ro‚Äòyxati.</p>

    <div id="requestsList" class="space-y-4">
      <p class="text-center text-gray-500" id="loadingMsg">So'rovlar yuklanmoqda...</p>
    </div>

    <p id="noRequestsMsg" class="text-center text-gray-500 mt-8 hidden">Tasdiqlanmagan so‚Äòrovlar mavjud emas.</p>
  </div>

  <script>
    const STORAGE_KEY_REQUESTS = "access_requests";
    const STORAGE_KEY_APPROVED = "approved_users";

    function loadRequests() {
      const requests = JSON.parse(localStorage.getItem(STORAGE_KEY_REQUESTS) || "[]");
      const listContainer = document.getElementById("requestsList");
      const noRequestsMsg = document.getElementById("noRequestsMsg");
      document.getElementById("loadingMsg").classList.add("hidden");
      listContainer.innerHTML = '';

      const pendingRequests = requests.filter(r => r.status === "pending");

      if (pendingRequests.length === 0) {
        noRequestsMsg.classList.remove("hidden");
        return;
      }
      noRequestsMsg.classList.add("hidden");

      pendingRequests.forEach(request => {
        const requestItem = document.createElement('div');
        requestItem.className = 'flex items-center justify-between p-4 border border-emerald-200 rounded-xl bg-white shadow-sm';
        requestItem.innerHTML = `
          <div>
            <p class="font-semibold text-gray-800">${request.login}</p>
            <span class="text-xs font-medium px-2 py-0.5 rounded-full status-pending">Kutilmoqda</span>
          </div>
          <div class="space-x-2">
            <button onclick="approveRequest('${request.login}', '${request.pass}')" class="bg-green-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-green-600 transition">
              Tasdiqlash
            </button>
            <button onclick="rejectRequest('${request.login}')" class="bg-red-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-600 transition">
              Rad etish
            </button>
          </div>
        `;
        listContainer.appendChild(requestItem);
      });
    }

    function approveRequest(login, pass) {
      // 1. So'rovni o'chirish
      let requests = JSON.parse(localStorage.getItem(STORAGE_KEY_REQUESTS) || "[]");
      requests = requests.filter(r => r.login !== login);
      localStorage.setItem(STORAGE_KEY_REQUESTS, JSON.stringify(requests));

      // 2. Tasdiqlanganlar ro'yxatiga qo'shish
      const approved = JSON.parse(localStorage.getItem(STORAGE_KEY_APPROVED) || "[]");
      if (!approved.some(u => u.login === login)) {
        approved.push({ login, pass });
        localStorage.setItem(STORAGE_KEY_APPROVED, JSON.stringify(approved));
        alert(`Foydalanuvchi ${login} tasdiqlandi va endi tizimga kira oladi.`);
      }

      loadRequests();
    }

    function rejectRequest(login) {
      let requests = JSON.parse(localStorage.getItem(STORAGE_KEY_REQUESTS) || "[]");
      // So'rovni ro'yxatdan o'chirish
      requests = requests.filter(r => r.login !== login);
      localStorage.setItem(STORAGE_KEY_REQUESTS, JSON.stringify(requests));
      alert(`Foydalanuvchi ${login} so'rovi rad etildi.`);
      loadRequests();
    }

    // Sahifa yuklanganda so'rovlarni yuklash
    window.onload = loadRequests;
  </script>
</body>
</html>
